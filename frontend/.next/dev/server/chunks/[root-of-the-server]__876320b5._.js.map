{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/koust/Downloads/code/frontend/app/api/gold-rates/route.ts"],"sourcesContent":["// API Route to fetch IBJA gold rates (server-side to avoid CORS)\r\nimport { NextResponse } from 'next/server';\r\n\r\nexport const dynamic = 'force-dynamic';\r\nexport const revalidate = 0;\r\n\r\ninterface IBJARate {\r\n  purity: string;\r\n  rate: number;\r\n}\r\n\r\nasync function fetchIBJAPage(): Promise<string> {\r\n  try {\r\n    const response = await fetch('https://ibjarates.com/', {\r\n      headers: {\r\n        'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36',\r\n      },\r\n      cache: 'no-store',\r\n    });\r\n\r\n    if (!response.ok) {\r\n      throw new Error(`HTTP error! status: ${response.status}`);\r\n    }\r\n\r\n    return await response.text();\r\n  } catch (error) {\r\n    console.error('Error fetching IBJA page:', error);\r\n    throw error;\r\n  }\r\n}\r\n\r\nfunction parseIBJARates(html: string): IBJARate[] {\r\n  const rates: IBJARate[] = [];\r\n\r\n  try {\r\n    console.log('Parsing IBJA HTML...');\r\n    \r\n    // Method 1: Try to extract from the main display sections (e.g., \"995 Purity ### 12429 (1 Gram)\")\r\n    const purityPatterns = [\r\n      { purity: '999', pattern: /999\\s+Purity[^0-9#]*#{1,3}\\s*(\\d{4,5})\\s*\\(1\\s*Gram\\)/i },\r\n      { purity: '995', pattern: /995\\s+Purity[^0-9#]*#{1,3}\\s*(\\d{4,5})\\s*\\(1\\s*Gram\\)/i },\r\n      { purity: '916', pattern: /916\\s+Purity[^0-9#]*#{1,3}\\s*(\\d{4,5})\\s*\\(1\\s*Gram\\)/i },\r\n      { purity: '750', pattern: /750\\s+Purity[^0-9#]*#{1,3}\\s*(\\d{4,5})\\s*\\(1\\s*Gram\\)/i },\r\n    ];\r\n\r\n    for (const { purity, pattern } of purityPatterns) {\r\n      const match = html.match(pattern);\r\n      if (match && match[1]) {\r\n        const rate = parseInt(match[1]);\r\n        console.log(`Found ${purity} purity rate: ${rate}`);\r\n        rates.push({ purity, rate });\r\n      }\r\n    }\r\n\r\n    // Method 2: If Method 1 fails, try simpler pattern (just number after purity)\r\n    if (rates.length === 0) {\r\n      console.log('Trying alternative parsing method...');\r\n      \r\n      // Look for pattern like \"995 Purity\" followed by numbers\r\n      const alt995Match = html.match(/995\\s+Purity[^\\d]*(\\d{4,5})/i);\r\n      if (alt995Match) {\r\n        const rate = parseInt(alt995Match[1]);\r\n        console.log(`Found 995 purity rate (alt method): ${rate}`);\r\n        rates.push({ purity: '995', rate });\r\n      }\r\n\r\n      const alt916Match = html.match(/916\\s+Purity[^\\d]*(\\d{4,5})/i);\r\n      if (alt916Match) {\r\n        const rate = parseInt(alt916Match[1]);\r\n        console.log(`Found 916 purity rate (alt method): ${rate}`);\r\n        rates.push({ purity: '916', rate });\r\n      }\r\n    }\r\n\r\n    // Method 3: Try to extract from the historical table (as backup)\r\n    if (rates.length === 0) {\r\n      console.log('Trying to parse from historical table...');\r\n      \r\n      // Look for the table with dates and rates\r\n      const tableMatch = html.match(/\\d{2}\\/\\d{2}\\/\\d{4}\\*\\*\\s+(\\d{5,6})\\s+(\\d{5,6})\\s+(\\d{5,6})/);\r\n      if (tableMatch) {\r\n        // Rates in table are per 10 grams, so divide by 10\r\n        const rate999 = Math.round(parseInt(tableMatch[1]) / 10);\r\n        const rate995 = Math.round(parseInt(tableMatch[2]) / 10);\r\n        const rate916 = Math.round(parseInt(tableMatch[3]) / 10);\r\n        \r\n        console.log(`Found rates from table - 999: ${rate999}, 995: ${rate995}, 916: ${rate916}`);\r\n        \r\n        rates.push({ purity: '999', rate: rate999 });\r\n        rates.push({ purity: '995', rate: rate995 });\r\n        rates.push({ purity: '916', rate: rate916 });\r\n      }\r\n    }\r\n\r\n    console.log(`Total rates parsed: ${rates.length}`);\r\n    return rates;\r\n  } catch (error) {\r\n    console.error('Error parsing IBJA rates:', error);\r\n    return [];\r\n  }\r\n}\r\n\r\nexport async function GET() {\r\n  try {\r\n    console.log('=== IBJA Gold Rates API Called ===');\r\n    \r\n    // Fetch IBJA page\r\n    const html = await fetchIBJAPage();\r\n    console.log('IBJA page fetched successfully, length:', html.length);\r\n\r\n    // Parse rates\r\n    const rates = parseIBJARates(html);\r\n    console.log('Parsed rates:', rates);\r\n\r\n    if (rates.length === 0) {\r\n      console.error('No rates parsed from IBJA page');\r\n      throw new Error('Could not parse rates from IBJA');\r\n    }\r\n\r\n    // Find 995 purity (24k base)\r\n    const base995 = rates.find((r) => r.purity === '995');\r\n\r\n    if (!base995) {\r\n      console.error('995 purity rate not found in parsed rates:', rates);\r\n      throw new Error('995 purity rate not found');\r\n    }\r\n\r\n    console.log('Using 995 purity base rate:', base995.rate);\r\n\r\n    // Calculate different karats\r\n    const karatRates = {\r\n      '24k': { purity: 99.5, rate: base995.rate },\r\n      '22k': { purity: 91.6, rate: Math.round((base995.rate * 91.6) / 99.5) },\r\n      '21k': { purity: 87.5, rate: Math.round((base995.rate * 87.5) / 99.5) },\r\n      '20k': { purity: 83.3, rate: Math.round((base995.rate * 83.3) / 99.5) },\r\n      '19k': { purity: 79.2, rate: Math.round((base995.rate * 79.2) / 99.5) },\r\n      '18k': { purity: 75.0, rate: Math.round((base995.rate * 75.0) / 99.5) },\r\n    };\r\n\r\n    console.log('Calculated karat rates:', karatRates);\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      source: 'IBJA',\r\n      timestamp: new Date().toISOString(),\r\n      base24k: base995.rate,\r\n      rates: karatRates,\r\n      rawData: rates,\r\n    });\r\n  } catch (error) {\r\n    console.error('=== Error in gold-rates API ===');\r\n    console.error('Error details:', error);\r\n\r\n    // Return mock data as fallback\r\n    const mockBase = 12429; // From IBJA website\r\n\r\n    const karatRates = {\r\n      '24k': { purity: 99.5, rate: mockBase },\r\n      '22k': { purity: 91.6, rate: Math.round((mockBase * 91.6) / 99.5) },\r\n      '21k': { purity: 87.5, rate: Math.round((mockBase * 87.5) / 99.5) },\r\n      '20k': { purity: 83.3, rate: Math.round((mockBase * 83.3) / 99.5) },\r\n      '19k': { purity: 79.2, rate: Math.round((mockBase * 79.2) / 99.5) },\r\n      '18k': { purity: 75.0, rate: Math.round((mockBase * 75.0) / 99.5) },\r\n    };\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      source: 'Mock Data (IBJA unavailable)',\r\n      timestamp: new Date().toISOString(),\r\n      base24k: mockBase,\r\n      rates: karatRates,\r\n      error: 'Using fallback data',\r\n    });\r\n  }\r\n}\r\n\r\n"],"names":[],"mappings":"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"}}]
}
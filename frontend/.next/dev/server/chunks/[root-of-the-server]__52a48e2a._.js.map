{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/koust/Downloads/code/frontend/app/api/applications/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\r\nimport { MongoClient, Db, Collection } from 'mongodb';\r\n\r\n// Re-use MongoDB client between requests in dev\r\nlet cachedClient: MongoClient | null = null;\r\nlet cachedDb: Db | null = null;\r\n\r\ninterface QuickApplication {\r\n  name: string;\r\n  phone: string;\r\n  loanAmount: string;\r\n  branch: string;\r\n  createdAt: string;\r\n  source: 'loan-quick-application';\r\n}\r\n\r\nasync function getDb(): Promise<Db> {\r\n  if (cachedDb) return cachedDb;\r\n\r\n  const uri =\r\n    process.env.DATABASE_URL ||\r\n    process.env.MONGODB_URI ||\r\n    '';\r\n\r\n  const dbName = process.env.DATABASE_DB || 'yellowmetal';\r\n\r\n  if (!uri) {\r\n    throw new Error(\r\n      'MongoDB connection string not set. Please set DATABASE_URL or MONGODB_URI in your environment.',\r\n    );\r\n  }\r\n\r\n  if (!cachedClient) {\r\n    cachedClient = new MongoClient(uri);\r\n  }\r\n\r\n  if (!cachedClient.topology) {\r\n    await cachedClient.connect();\r\n  }\r\n\r\n  cachedDb = cachedClient.db(dbName);\r\n  return cachedDb;\r\n}\r\n\r\nfunction validatePayload(body: any) {\r\n  const errors: string[] = [];\r\n\r\n  if (!body || typeof body !== 'object') {\r\n    errors.push('Invalid request body');\r\n    return errors;\r\n  }\r\n\r\n  if (!body.name || typeof body.name !== 'string') {\r\n    errors.push('Name is required');\r\n  }\r\n\r\n  if (!body.phone || typeof body.phone !== 'string') {\r\n    errors.push('Phone is required');\r\n  }\r\n\r\n  if (!body.loanAmount || typeof body.loanAmount !== 'string') {\r\n    errors.push('Loan amount is required');\r\n  }\r\n\r\n  if (!body.branch || typeof body.branch !== 'string') {\r\n    errors.push('Branch or pincode is required');\r\n  }\r\n\r\n  return errors;\r\n}\r\n\r\nexport async function POST(request: Request) {\r\n  try {\r\n    const body = await request.json();\r\n    const errors = validatePayload(body);\r\n\r\n    if (errors.length > 0) {\r\n      return NextResponse.json(\r\n        { success: false, errors },\r\n        { status: 400 },\r\n      );\r\n    }\r\n\r\n    const db = await getDb();\r\n    const collection: Collection<QuickApplication> =\r\n      db.collection<QuickApplication>('quick_applications');\r\n\r\n    const doc: QuickApplication = {\r\n      name: body.name.trim(),\r\n      phone: body.phone.trim(),\r\n      loanAmount: body.loanAmount.trim(),\r\n      branch: body.branch.trim(),\r\n      createdAt: new Date().toISOString(),\r\n      source: 'loan-quick-application',\r\n    };\r\n\r\n    const result = await collection.insertOne(doc);\r\n\r\n    return NextResponse.json(\r\n      {\r\n        success: true,\r\n        id: result.insertedId,\r\n      },\r\n      { status: 201 },\r\n    );\r\n  } catch (error) {\r\n    console.error('Error saving quick application:', error);\r\n    return NextResponse.json(\r\n      {\r\n        success: false,\r\n        error:\r\n          'Failed to save application. Please try again later.',\r\n      },\r\n      { status: 500 },\r\n    );\r\n  }\r\n}\r\n\r\nexport async function GET() {\r\n  return NextResponse.json(\r\n    {\r\n      success: false,\r\n      message:\r\n        'GET not allowed on this endpoint. Use POST to submit applications.',\r\n    },\r\n    { status: 405 },\r\n  );\r\n}\r\n\r\n\r\n"],"names":[],"mappings":";;;;;;AAAA;;;;;;;;AAGA,gDAAgD;AAChD,IAAI,eAAmC;AACvC,IAAI,WAAsB;AAW1B,eAAe;IACb,IAAI,UAAU,OAAO;IAErB,MAAM,MACJ,QAAQ,GAAG,CAAC,YAAY,IACxB,QAAQ,GAAG,CAAC,WAAW,IACvB;IAEF,MAAM,SAAS,QAAQ,GAAG,CAAC,WAAW,IAAI;IAE1C,IAAI,CAAC,KAAK;QACR,MAAM,IAAI,MACR;IAEJ;IAEA,IAAI,CAAC,cAAc;QACjB,eAAe,IAAI,YAAY;IACjC;IAEA,IAAI,CAAC,aAAa,QAAQ,EAAE;QAC1B,MAAM,aAAa,OAAO;IAC5B;IAEA,WAAW,aAAa,EAAE,CAAC;IAC3B,OAAO;AACT;AAEA,SAAS,gBAAgB,IAAS;IAChC,MAAM,SAAmB,EAAE;IAE3B,IAAI,CAAC,QAAQ,OAAO,SAAS,UAAU;QACrC,OAAO,IAAI,CAAC;QACZ,OAAO;IACT;IAEA,IAAI,CAAC,KAAK,IAAI,IAAI,OAAO,KAAK,IAAI,KAAK,UAAU;QAC/C,OAAO,IAAI,CAAC;IACd;IAEA,IAAI,CAAC,KAAK,KAAK,IAAI,OAAO,KAAK,KAAK,KAAK,UAAU;QACjD,OAAO,IAAI,CAAC;IACd;IAEA,IAAI,CAAC,KAAK,UAAU,IAAI,OAAO,KAAK,UAAU,KAAK,UAAU;QAC3D,OAAO,IAAI,CAAC;IACd;IAEA,IAAI,CAAC,KAAK,MAAM,IAAI,OAAO,KAAK,MAAM,KAAK,UAAU;QACnD,OAAO,IAAI,CAAC;IACd;IAEA,OAAO;AACT;AAEO,eAAe,KAAK,OAAgB;IACzC,IAAI;QACF,MAAM,OAAO,MAAM,QAAQ,IAAI;QAC/B,MAAM,SAAS,gBAAgB;QAE/B,IAAI,OAAO,MAAM,GAAG,GAAG;YACrB,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,SAAS;gBAAO;YAAO,GACzB;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,KAAK,MAAM;QACjB,MAAM,aACJ,GAAG,UAAU,CAAmB;QAElC,MAAM,MAAwB;YAC5B,MAAM,KAAK,IAAI,CAAC,IAAI;YACpB,OAAO,KAAK,KAAK,CAAC,IAAI;YACtB,YAAY,KAAK,UAAU,CAAC,IAAI;YAChC,QAAQ,KAAK,MAAM,CAAC,IAAI;YACxB,WAAW,IAAI,OAAO,WAAW;YACjC,QAAQ;QACV;QAEA,MAAM,SAAS,MAAM,WAAW,SAAS,CAAC;QAE1C,OAAO,gJAAY,CAAC,IAAI,CACtB;YACE,SAAS;YACT,IAAI,OAAO,UAAU;QACvB,GACA;YAAE,QAAQ;QAAI;IAElB,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,mCAAmC;QACjD,OAAO,gJAAY,CAAC,IAAI,CACtB;YACE,SAAS;YACT,OACE;QACJ,GACA;YAAE,QAAQ;QAAI;IAElB;AACF;AAEO,eAAe;IACpB,OAAO,gJAAY,CAAC,IAAI,CACtB;QACE,SAAS;QACT,SACE;IACJ,GACA;QAAE,QAAQ;IAAI;AAElB"}}]
}